v: 3

db:                     /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/ctrl.db

identity:
  cert:                 /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/certs/{{ .Component.PublicIdentity }}-client.cert
  server_cert:          /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/certs/{{ .Component.PublicIdentity }}-server.cert
  key:                  /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/keys/{{ .Component.PublicIdentity }}.key
  ca:                   /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/certs/{{ .Component.PublicIdentity }}-server.chain.pem

network:
  cycleSeconds:         2
  smart:
    rerouteFraction:    0.2
    rerouteCap:         256

ctrl:
  listener:             tls:0.0.0.0:6262

mgmt:
  listener:             tls:0.0.0.0:10000

# By having an 'edge' section defined, the ziti-controller will attempt to parse the edge configuration. Removing this
# section, commenting out, or altering the name of the section will cause the edge to not run.
edge:
  # This section represents the configuration of the Edge API that is served over HTTPS
  api:
    # (required) The interface and port that the Edge API should be served on.
    listener:  0.0.0.0:1280
    # (required) The host/port combination that is reported as publicly accessible for the Edge API
    advertise: {{ .Host.PublicIp }}:1280
    # (optional, defaults to 10) The number of minutes before an Edge API session will timeout. Timeouts are reset by
    # API requests and connections that are maintained to Edge Routers
    sessionTimeoutMinutes: 30
    #(optional, defaults to the root identity) An alternate "identity" to use for the Edge API. If this section is not
    # defined the root identity section will be used. This is useful for situations where Edge API will present a
    # publicly signed certificate instead of one generated by a private PKI created by ziti pki create
  #    identity:
  #      server_cert: edge/tests/pki/ziti-dev-controller01.external.cert.pem
  #      server_key:  edge/tests/pki/ziti-dev-controller01.external.key.pem
  #      ca:          edge/tests/pki/ziti-dev-controller01.external.chain.cert.pem
  # This section is used to define option that are used during enrollment of Edge Routers, Ziti Edge Identities.
  enrollment:
    # (required) A Ziti Identity configuration section that specifically makes use of the cert and key fields to define
    # a signing certificate from the PKI that the Ziti environment is using to sign certificates. The signingCert.cert
    # will be added to the /.well-known CA store that is used to bootstrap trust with the Ziti Controller.
    signingCert:
      cert: /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/certs/intermediate.cert
      key: /home/{{ .Model.MustVariable "credentials" "ssh" "username" }}/fablab/pki/intermediate/keys/intermediate.key
    edgeIdentity:
      # (optional, defaults to 5) The length of time that a Ziti Edge Identity enrollment should remain valid. After
      # this duration, the enrollment will expire and not longer be usable.
      durationMinutes: 1440
    edgeRouter:
      # (optional, defaults to 5) The length of time that a Ziti Edge Router enrollment should remain valid. After
      # this duration, the enrollment will expire and not longer be usable.
      durationMinutes: 1440
